# ============================================================================
# Lake Erie Live Monitor — BlueNexus Configuration
# ============================================================================
# This file defines datasets, thresholds, geographic bounds, and scheduling
# for the Streamlit dashboard and the historical archive builder.
#
# IMPORTANT: The dataset IDs below must match the identifiers on the NOAA
# GLERL ERDDAP server (https://apps.glerl.noaa.gov/erddap).  Do not change
# them unless the server renames its datasets.
# ============================================================================

# ── ERDDAP connection & datasets ──
erddap:
  base_url: "https://apps.glerl.noaa.gov/erddap"

  # Sea Surface Temperature — GLSEA ACSPO Great Lakes Composite
  # Coverage: 2006-12-11 to present, ~1.3 km, daily
  sst_dataset: "GLSEA_ACSPO_GCS"

  # Chlorophyll-a — Great Lakes Daily CHL
  # Coverage: 2012-03 to 2023-12, ~1 km, daily
  chl_dataset: "GR_Daily_CHL_test"
  chl_variable: "chl" # NetCDF variable name

  # Timeout settings (seconds)
  # Historical queries (e.g. 2007 data) require the server to read from
  # cold storage and can take 3-5+ minutes.  Recent data is much faster.
  connect_timeout: 30 # Max seconds to establish TCP connection
  read_timeout: 600 # Max seconds to download the full response

  # Retry & rate-limit settings
  retry_attempts: 5 # Number of download attempts per request
  retry_delay: 15 # Base delay (seconds) between retries
  request_delay: 5 # Delay (seconds) between successive requests

# ── Geographic bounding box (Lake Erie) ──
bbox:
  lat_min: 41.35
  lat_max: 42.90
  lon_min: -83.55
  lon_max: -78.80

# ── Bloom risk thresholds ──
thresholds:
  sst_bloom: 20.0 # °C — SST above this favors blooms
  chl_low: 10.0 # mg/m³ — elevated chlorophyll
  chl_moderate: 20.0 # mg/m³ — moderate bloom
  chl_high: 40.0 # mg/m³ — active bloom
  western_basin_lon: -82.0 # °W — divides west / east basin

# ── Automatic update schedule ──
schedule:
  hour: 6 # Hour of day (24h) for daily fetch
  minute: 0 # Minute past the hour

# ── Data retention ──
retention_days: 365 # Days of data to keep before cleanup

# ============================================================================
# DATASET REGISTRY — Foundation for modular multi-dataset support
# ============================================================================
# Each entry defines a complete data source that the pipeline can ingest.
# To add a new dataset (e.g., Lake Michigan SST, dissolved oxygen), add an
# entry here and the pipeline will handle download, storage, and display.
#
# This registry coexists with the legacy erddap.sst_dataset / chl_dataset
# keys above.  Future versions will migrate fully to this pattern.
#
# Fields:
#   id:          Unique key used internally (table names, config refs)
#   name:        Human-readable display name
#   source:      Data source type (erddap, csv, api)
#   erddap_id:   Dataset ID on the ERDDAP server
#   variable:    NetCDF variable name to extract
#   unit:        Display unit for labels and legends
#   coverage:    Known temporal coverage (for date validation)
#   color:       Primary chart color (hex)
#   thresholds:  Optional domain-specific thresholds
#   region:      Geographic context
# ============================================================================

datasets:
  - id: sst
    name: "Sea Surface Temperature"
    source: erddap
    erddap_id: "GLSEA_ACSPO_GCS"
    variable: "sst"
    unit: "°C"
    coverage:
      start: "2006-12-11"
      end: "present"
    color: "#ff6b6b"
    thresholds:
      bloom_favorable: 20.0
      peak_growth: 25.0
    region: "Lake Erie"

  - id: chl
    name: "Chlorophyll-a"
    source: erddap
    erddap_id: "GR_Daily_CHL_test"
    variable: "chl"
    unit: "mg/m³"
    coverage:
      start: "2012-03-01"
      end: "2023-12-31"
    color: "#2dd4a8"
    thresholds:
      elevated: 10.0
      moderate_bloom: 20.0
      active_bloom: 40.0
    region: "Lake Erie"

  # ── TEMPLATE: Add new datasets below ──
  # Uncomment and fill in to add a new data source:
  #
  # - id: dissolved_oxygen
  #   name: "Dissolved Oxygen"
  #   source: erddap
  #   erddap_id: "SOME_DATASET_ID"
  #   variable: "do"
  #   unit: "mg/L"
  #   coverage:
  #     start: "2015-01-01"
  #     end: "present"
  #   color: "#82aaff"
  #   thresholds:
  #     hypoxic: 2.0
  #     stressed: 4.0
  #   region: "Lake Erie"
  #
  # - id: lake_michigan_sst
  #   name: "Lake Michigan SST"
  #   source: erddap
  #   erddap_id: "GLSEA_ACSPO_GCS"
  #   variable: "sst"
  #   unit: "°C"
  #   coverage:
  #     start: "2006-12-11"
  #     end: "present"
  #   color: "#89ddff"
  #   thresholds:
  #     bloom_favorable: 18.0
  #   region: "Lake Michigan"
  #   bbox:
  #     lat_min: 41.5
  #     lat_max: 46.1
  #     lon_min: -87.8
  #     lon_max: -84.8
